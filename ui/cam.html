<!DOCTYPE html>
<html>

<meta charset=utf-8>
<meta name=viewport content="width=device-width, height=device-height, user-scalable=no">

<link rel=stylesheet href=style.css>
<script src=https://apprtc.appspot.com/js/adapter.js></script>
<script>
function error(err) {
	console.log(err.message)
}

(function () {
	var constraints = {video: true, audio: false}
	var ws = new WebSocket('ws://' + location.host + '/answer')
	var cfg = {"iceServers": [{"url": "stun:stun.l.google.com:19302"}]};
	var pc = new RTCPeerConnection(cfg);
	
	ws.onmessage = function(m) {
		var msg = JSON.parse(m.data);
		if (msg.type === 'offer') {
			console.log("got offer", msg)
			pc.setRemoteDescription(new RTCSessionDescription(msg), function(){}, error);
			pc.createAnswer(function(desc) {
				pc.setLocalDescription(desc);
				ws.send(JSON.stringify(desc));
			});
		} else if (msg.type === 'candidate') {
			console.log("got candidate", msg)
			var candidate = new RTCIceCandidate({
				sdpMLineIndex:msg.label,
				candidate:msg.candidate});
			pc.addIceCandidate(candidate);
		} else {
			console.log("what's this?", msg)
		}
	}
	
	pc.onicecandidate = function(e) {
		if (e.candidate) {
			console.log("sending candidate", e.candidate)
			ws.send(JSON.stringify({
				type: "candidate",
				label: event.candidate.sdpMLineIndex,
				id: event.candidate.sdpMid,
				candidate: event.candidate.candidate}));
		}
	}
	pc.onconnecting = function (ev) {
		console.log("connecting...", ev)
	};
	pc.onopen = function (ev) {
		console.log("open!", ev)
	};
	pc.onaddstream = function (ev) {
		console.log("addStream!", ev)
	};
	
	getUserMedia(constraints, function (stream){
		console.log("adding stream", stream)
		pc.addStream(stream);
	}, error);

})();
</script>
<title>cam</title>
<body>
<h1>Smile!
