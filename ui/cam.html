<!DOCTYPE html>
<html>

<meta charset=utf-8>
<meta name=viewport content="width=device-width, height=device-height, user-scalable=no">

<link rel=stylesheet href=style.css>
<script src=https://apprtc.appspot.com/js/adapter.js></script>
<script>
function error(err) {
	console.log(err.message)
}

(function () {
	var ws = new WebSocket('ws://' + location.host + '/answer')
	var cfg = {"iceServers": [{"url": "stun:stun.l.google.com:19302"}]};
	var pc = new RTCPeerConnection(cfg);
	
	ws.onmessage = function(m) {
		var msg = JSON.parse(m.data);
		if (msg.type === 'answer') {
			pc.setRemoteDescription(new RTCSessionDescription(msg), function(){}, error);
		} else if (msg.type === 'candidate') {
			pc.addIceCandidate(new RTCIceCandidate(msg));
		} else {
			console.log("what's this?", msg)
		}
	}
	
	ws.onopen = function (ev) {
		getUserMedia({video: true, audio: false}, function (stream){
			pc.addStream(stream);
			pc.createOffer(function(desc) {
				pc.setLocalDescription(desc);
				ws.send(JSON.stringify(desc));
			});
		}, error);
	};
	
	pc.onicecandidate = function(e) {
		if (e.candidate) {
			e.candidate.type="candidate";
			ws.send(JSON.stringify(e.candidate));
		}
	}
	
})();
</script>

<title>cam</title>
<body>
<h1>Smile!
